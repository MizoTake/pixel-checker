<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>透明ピクセル塗りつぶしツール - テスト</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-image {
            display: inline-block;
            margin: 10px;
            text-align: center;
        }
        .test-image canvas {
            border: 1px solid #ddd;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><rect width="10" height="10" fill="%23e0e0e0"/><rect x="10" y="10" width="10" height="10" fill="%23e0e0e0"/></svg>');
        }
        .test-image p {
            margin: 5px 0;
            font-size: 14px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>透明ピクセル塗りつぶしツール - テストページ</h1>
    
    <div class="test-section">
        <h2>テスト画像生成</h2>
        <p>透明度を含むテスト画像を生成します：</p>
        
        <div id="testImages"></div>
        
        <button onclick="generateTestImages()">テスト画像を生成</button>
        <button onclick="downloadTestImage('png')">PNG をダウンロード</button>
        <button onclick="downloadTestImage('webp')">WebP をダウンロード</button>
    </div>

    <div class="test-section">
        <h2>メインアプリケーションへのリンク</h2>
        <p><a href="index.html">透明ピクセル塗りつぶしツールを開く</a></p>
    </div>

    <div id="status"></div>

    <script>
        let testCanvas;

        function generateTestImages() {
            const container = document.getElementById('testImages');
            container.innerHTML = '';
            
            // Create test patterns
            const patterns = [
                { name: '完全透明', alpha: 0 },
                { name: '25%透明', alpha: 0.25 },
                { name: '50%透明', alpha: 0.5 },
                { name: '75%透明', alpha: 0.75 },
                { name: 'グラデーション', alpha: 'gradient' },
                { name: 'チェッカーボード', alpha: 'checker' }
            ];
            
            patterns.forEach(pattern => {
                const wrapper = document.createElement('div');
                wrapper.className = 'test-image';
                
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                
                // Create pattern
                if (pattern.alpha === 'gradient') {
                    // Gradient transparency
                    const gradient = ctx.createLinearGradient(0, 0, 200, 200);
                    gradient.addColorStop(0, 'rgba(255, 0, 0, 1)');
                    gradient.addColorStop(0.5, 'rgba(0, 255, 0, 0.5)');
                    gradient.addColorStop(1, 'rgba(0, 0, 255, 0)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, 200, 200);
                } else if (pattern.alpha === 'checker') {
                    // Checkerboard pattern with transparency
                    const size = 25;
                    for (let y = 0; y < 200; y += size) {
                        for (let x = 0; x < 200; x += size) {
                            const isEven = ((x / size + y / size) % 2) === 0;
                            if (isEven) {
                                ctx.fillStyle = 'rgba(100, 100, 255, 1)';
                            } else {
                                ctx.fillStyle = 'rgba(255, 100, 100, 0.3)';
                            }
                            ctx.fillRect(x, y, size, size);
                        }
                    }
                } else {
                    // Solid color with alpha
                    ctx.fillStyle = `rgba(100, 150, 200, ${pattern.alpha})`;
                    ctx.fillRect(0, 0, 200, 200);
                    
                    // Add some shapes
                    ctx.fillStyle = `rgba(255, 100, 100, ${pattern.alpha})`;
                    ctx.beginPath();
                    ctx.arc(100, 100, 50, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Add contour detection test pattern
                if (pattern.name === 'チェッカーボード') {
                    // Add a solid border to test contour detection
                    ctx.fillStyle = 'rgba(50, 50, 50, 1)';
                    ctx.fillRect(0, 0, 200, 10);
                    ctx.fillRect(0, 190, 200, 10);
                    ctx.fillRect(0, 0, 10, 200);
                    ctx.fillRect(190, 0, 10, 200);
                    
                    // Add transparent holes in the center
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.fillStyle = 'rgba(0, 0, 0, 1)';
                    ctx.beginPath();
                    ctx.arc(100, 100, 20, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillRect(80, 60, 40, 20);
                    ctx.globalCompositeOperation = 'source-over';
                }
                
                const label = document.createElement('p');
                label.textContent = pattern.name;
                
                wrapper.appendChild(canvas);
                wrapper.appendChild(label);
                container.appendChild(wrapper);
                
                // Save last canvas for download
                if (pattern.alpha === 'checker') {
                    testCanvas = canvas;
                }
            });
            
            showStatus('テスト画像を生成しました', 'success');
        }
        
        function downloadTestImage(format) {
            if (!testCanvas) {
                showStatus('先にテスト画像を生成してください', 'error');
                return;
            }
            
            const mimeType = format === 'webp' ? 'image/webp' : 'image/png';
            testCanvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `test_transparent.${format}`;
                a.click();
                URL.revokeObjectURL(url);
                showStatus(`${format.toUpperCase()} 形式でダウンロードしました`, 'success');
            }, mimeType);
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
            setTimeout(() => {
                status.textContent = '';
                status.className = 'status';
            }, 3000);
        }
        
        // Generate test images on load
        window.addEventListener('DOMContentLoaded', generateTestImages);
    </script>
</body>
</html>